<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbre de la Création Islamique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Styles pour l'arbre */
        .tree ul {
            padding-top: 20px;
            position: relative;
            transition: all 0.5s;
        }

        .tree li {
            float: left;
            text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 5px 0 5px;
            transition: all 0.5s;
        }

        /* Connecteurs */
        .tree li::before, .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 50%;
            border-top: 1px solid #ccc;
            width: 50%;
            height: 20px;
        }

        .tree li::after {
            right: auto;
            left: 50%;
            border-left: 1px solid #ccc;
        }

        /* On supprime les connecteurs des éléments sans parents */
        .tree li:only-child::after, .tree li:only-child::before {
            display: none;
        }

        /* On supprime le connecteur gauche du premier enfant et le connecteur droit du dernier enfant */
        .tree li:first-child::before, .tree li:last-child::after {
            border: 0 none;
        }

        /* On ajoute un connecteur vertical au dessus du dernier enfant */
        .tree li:last-child::before {
            border-right: 1px solid #ccc;
            border-radius: 0 5px 0 0;
        }

        .tree li:first-child::after {
            border-radius: 5px 0 0 0;
        }

        /* On ajoute les connecteurs horizontaux */
        .tree ul ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            border-left: 1px solid #ccc;
            width: 0;
            height: 20px;
        }

        .tree li a {
            border: 1px solid #ccc;
            padding: 5px 10px;
            text-decoration: none;
            color: #666;
            font-family: arial, verdana, tahoma;
            font-size: 11px;
            display: inline-block;
            border-radius: 5px;
            transition: all 0.5s;
            cursor: pointer;
        }
          /* Styles pour les tooltips (informations au survol) */
        .tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            display: none; /* Caché par défaut */
            z-index: 1000; /* Au-dessus de tout */
            white-space: nowrap; /* Empêche le retour à la ligne */
        }

        .tree li a:hover + .tooltip,
        .tree li a:focus + .tooltip {
          display: block; /* Affiché au survol/focus */
        }

        /* Styles pour le modal */
       /* Styles pour le modal */
.modal {
    display: none; /* Caché par défaut */
    position: fixed; /* Reste en place lors du défilement */
    z-index: 1000;  /* Au-dessus de tout le reste */
    left: 0;
    top: 0;
    width: 100%;    /* Pleine largeur */
    height: 100%;   /* Pleine hauteur */
    overflow: auto; /* Ajoute des barres de défilement si nécessaire */
    background-color: rgba(0, 0, 0, 0.4); /* Fond semi-transparent */
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% du haut, centré horizontalement */
    padding: 20px;
    border: 1px solid #888;
    width: 80%;    /* 80% de la largeur de la fenêtre */
    max-width: 600px; /* Largeur maximale */
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Ombre légère */
    position: relative; /* Nécessaire pour le bouton de fermeture */
}

.close {
    color: #aaa;
    position: absolute; /* Position absolue par rapport à .modal-content */
    top: 10px;
    right: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-6">Arbre de la Création Islamique</h1>

      <button id="asma-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4">
       Afficher les 99 Noms d'Allah
      </button>

        <!-- Modal pour les 99 Noms -->
      <div id="asma-modal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2 class="text-2xl font-bold mb-4">Les 99 Noms d'Allah (Asma al-Husna)</h2>
          <div id="asma-list">
            <!-- Les noms seront insérés ici par JavaScript -->
          </div>
        </div>
      </div>
        <div class="tree">
            <ul id="tree-root">
                <!-- L'arbre sera généré ici par JavaScript -->
            </ul>
        </div>
    </div>

<script>
    const basePath = "data/"; // Chemin de base vers le dossier data

    // Fonction asynchrone pour charger un fichier JSON
    async function fetchData(filePath) {
        const fullPath = basePath + filePath; // Construction du chemin complet
        const response = await fetch(fullPath);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}, path: ${fullPath}`); // Message d'erreur détaillé
        }
        return await response.json();
    }

    // Fonction pour afficher les détails d'un nœud dans le modal
    function showNodeDetails(nodeData) {
        const modal = document.getElementById("asma-modal"); // Récupère le modal (on réutilise le modal des 99 noms)
        const modalContent = modal.querySelector(".modal-content");
        modalContent.innerHTML = ''; // Vide le contenu précédent

        // Crée le bouton de fermeture (à l'intérieur du modal)
        const closeBtn = document.createElement('span');
        closeBtn.classList.add('close');
        closeBtn.innerHTML = '×';
        closeBtn.onclick = () => {
            modal.style.display = 'none';
        };
        modalContent.appendChild(closeBtn);

        const detailsDiv = document.createElement('div'); // Conteneur pour les détails
        detailsDiv.classList.add('bg-white', 'p-4', 'rounded', 'shadow', 'mt-2', 'text-sm');

        // Ajoute le titre
        const title = document.createElement('h3');
        title.classList.add('text-lg', 'font-bold', 'mb-2');
        title.textContent = nodeData.title;
        detailsDiv.appendChild(title);

        // Ajoute la description
        if (nodeData.description) {
            const description = document.createElement('p');
            description.textContent = nodeData.description;
            detailsDiv.appendChild(description);
        }

        // Ajoute les versets coraniques
        if (nodeData.quranVerses && nodeData.quranVerses.length > 0) {
            const quranVersesTitle = document.createElement('h4');
            quranVersesTitle.classList.add('font-bold', 'mt-4', 'mb-1');
            quranVersesTitle.textContent = 'Versets Coraniques:';
            detailsDiv.appendChild(quranVersesTitle);

            const quranVersesList = document.createElement('ul');
            nodeData.quranVerses.forEach(verse => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${verse.surah} (${verse.ayah}):</strong> <em>${verse.ar}</em> - ${verse.fr}`;
                quranVersesList.appendChild(listItem);
            });
            detailsDiv.appendChild(quranVersesList);
        }

        // Ajoute les hadiths
        if (nodeData.hadiths && nodeData.hadiths.length > 0) {
            const hadithsTitle = document.createElement('h4');
            hadithsTitle.classList.add('font-bold', 'mt-4', 'mb-1');
            hadithsTitle.textContent = 'Hadiths:';
            detailsDiv.appendChild(hadithsTitle);

            const hadithsList = document.createElement('ul');
            nodeData.hadiths.forEach(hadith => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<em>${hadith.ar}</em> - ${hadith.fr} (${hadith.narrator})`;
                hadithsList.appendChild(listItem);
            });
            detailsDiv.appendChild(hadithsList);
        }

        // Ajoute le texte arabe (si présent)
        if (nodeData.arabicText) {
            const arabicTextTitle = document.createElement('h4');
            arabicTextTitle.classList.add('font-bold', 'mt-4', 'mb-1');
            arabicTextTitle.textContent = 'Texte Arabe:';
            detailsDiv.appendChild(arabicTextTitle);

            const arabicTextPara = document.createElement('p');
            arabicTextPara.classList.add('text-right', 'font-arabic'); // Assurez-vous d'avoir une classe CSS 'font-arabic'
            arabicTextPara.textContent = nodeData.arabicText;
            detailsDiv.appendChild(arabicTextPara);
        }

        // Afficher l'image.
        if (nodeData.imageUrl) {
            const image = document.createElement('img');
            image.src = nodeData.imageUrl;
            image.alt = nodeData.title;
            image.classList.add('mt-4', 'max-w-full'); // Image responsive
            detailsDiv.appendChild(image);
        }

        modalContent.appendChild(detailsDiv); // Ajoute les détails au modal
        modal.style.display = "block";     // Affiche le modal
    }

    // Fonction récursive pour construire l'arbre
    function buildTree(nodeData, parentElement) {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.textContent = nodeData.title;
        a.href = "#"; // Empêche le comportement par défaut du lien
        a.addEventListener('click', (event) => {
            event.preventDefault(); // Empêche le rechargement de la page
            showNodeDetails(nodeData); // Affiche les détails du nœud
        });
        li.appendChild(a);

        // Tooltip (seulement si une description est présente)
        if (nodeData.description) {
            const tooltip = document.createElement('div');
            tooltip.classList.add('tooltip');
            tooltip.textContent = nodeData.description;
            li.appendChild(tooltip);
        }

        if (nodeData.children && nodeData.children.length > 0) {
            const ul = document.createElement('ul');
            nodeData.children.forEach(child => {
                if (child.$ref) {
                    // Charge les données de l'enfant de manière asynchrone
                    fetchData(child.$ref)
                        .then(childData => {
                            buildTree(childData, ul); // Appel récursif
                        })
                        .catch(error => {
                            console.error("Erreur lors du chargement de", child.$ref, error);
                            // Affiche un message d'erreur dans l'arbre (optionnel)
                            const errorLi = document.createElement('li');
                            errorLi.textContent = `Erreur lors du chargement de ${child.$ref}`;
                            errorLi.style.color = 'red';
                            ul.appendChild(errorLi);
                        });
                } else {
                    // Les données de l'enfant sont déjà présentes (pas de $ref)
                    buildTree(child, ul); // Appel récursif direct
                }
            });
            li.appendChild(ul);
        }
        parentElement.appendChild(li);
    }

    // Point d'entrée : s'exécute après le chargement du DOM
    document.addEventListener('DOMContentLoaded', () => {
        const treeRoot = document.getElementById('tree-root');

        // Charge les données d'Allah et construit l'arbre
        fetchData("allah.json")
            .then(allahData => {
                buildTree(allahData, treeRoot);
            })
            .catch(error => console.error("Erreur de chargement:", error));

        // --- Gestion du modal des 99 noms ---
        const asmaButton = document.getElementById('asma-button');
        const asmaModal = document.getElementById('asma-modal');
        const asmaList = document.getElementById('asma-list');


        asmaButton.onclick = () => {
            asmaModal.style.display = 'block';

            // Charge les noms si ce n'est pas déjà fait (évite les chargements multiples)
            if (asmaList.innerHTML === "") { // Vérification plus performante
                fetchData("allah.json")
                    .then(data => {
                        if (data.asmaAlHusna) {
                            data.asmaAlHusna.forEach(nom => {
                                const div = document.createElement('div');
                                div.classList.add('mb-2');
                                div.innerHTML = `<span class="font-bold">${nom.ar}</span> - ${nom.fr}`;
                                asmaList.appendChild(div);
                            });
                        } else {
                            asmaList.innerHTML = "<p>Erreur: Impossible de charger les 99 noms.</p>"; // Message d'erreur
                        }
                    })
                    .catch(error => {
                        console.error("Erreur:", error);
                        asmaList.innerHTML = "<p>Erreur lors du chargement des données.</p>"; // Message d'erreur
                    });
            }
        };

        // Fermer le modal (en cliquant sur le bouton 'x')
        asmaModal.querySelector('.close').onclick = () => {  //Correction ici
            asmaModal.style.display = 'none';
        };

        // Fermer le modal en cliquant en dehors du modal
        window.onclick = (event) => {
            if (event.target == asmaModal) {
                asmaModal.style.display = "none";
            }
        };
    });
</script>
</body>
</html>